/**
 * @license Handlebars hbs 0.4.0 - Alex Sexton, but Handlebars has it's own licensing junk
 *
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/require-cs for details on the plugin this was based off of
 */

define(["handlebars","underscore","i18nprecompile"],function(e,t,n){var r,i,s=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],o=function(){throw new Error("Environment unsupported.")},u=[],a="w+",f="hbs",l="@hbs",c="/styles/",h="/demo-build/styles/",p="template/helpers/",d="template/i18n/",v="screen.build.css";e.registerHelper("$",function(){}),typeof window!="undefined"&&window.navigator&&window.document&&!window.navigator.userAgent.match(/Node.js/)?(i=function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;for(t=0;t<3;t++){n=s[t];try{e=new ActiveXObject(n)}catch(r){}if(e){s=[n];break}}if(!e)throw new Error("getXhr(): XMLHttpRequest not available");return e},o=function(e,t){var n=i();n.open("GET",e,!0),n.onreadystatechange=function(e){n.readyState===4&&t(n.responseText)},n.send(null)}):typeof process!="undefined"&&process.versions&&!!process.versions.node?(r=require.nodeRequire("fs"),o=function(e,t){var n=r.readFileSync(e,"utf8")||"";n=n.replace(/^\uFEFF/,""),t(n)}):typeof java!="undefined"&&typeof java.io!="undefined"&&(o=function(e,t){var n=new java.io.File(e),r=new java.io.FileReader(n),i=new java.io.BufferedReader(r),s,o="";while((s=i.readLine())!==null)o+=new String(s)+"\n";i.close(),t(o)});var m={},g=function(e,t){m[e]?t(m[e]):o(e,function(n){m[e]=n,t.call(this,n)})},y=[],b={};return{get:function(){return e},write:function(e,t,n){if(t+l in u){var r=u[t+l];n.asModule(e+"!"+t,r)}},version:"0.4.0",load:function(i,s,m,w){function T(e,n){return t(e).forEach(function(e){e&&e.type&&e.type==="partial"&&n.push(e.partialName.name),e&&e.program&&e.program.statements&&T(e.program.statements,n),e&&e.program&&e.program.inverse&&e.program.inverse.statements&&T(e.program.inverse.statements,n)}),n}function N(e){var n=[];return e&&e.statements&&(n=T(e.statements,[])),t(n).unique()}function C(e){var t,n,r;if(e&&e.statements){t=e.statements[0];if(t&&t.type==="comment")try{return n=t.comment.replace(new RegExp("^[\\s]+|[\\s]+$","g"),""),r=JSON.parse(n),n}catch(i){return"{}"}}return"{}"}function k(e){if(!e)return[];var t=[e[0]],n=e[0],r;for(r=1;r<e.length;++r)e.hasOwnProperty(r)&&(n+="."+e[r],t.push(n));return t}function L(n,r,i,s){i=i?i+".":"";var o="",u=!1;return t(n).forEach(function(n){var u,a,f;if(n&&n.type&&n.type==="mustache"){if(!n.params||!n.params.length){u=k(n.id.parts);for(a in u)u[a]&&(o=u[a]||o,r.push(i+u[a]));r.push(i+n.id.string)}var l=["this",".","..","./..","../..","../../.."];n.params&&typeof e.helpers[n.id.string]=="undefined"&&t(n.params).forEach(function(a){(t(l).contains(a.original)||a instanceof e.AST.StringNode||a instanceof e.AST.IntegerNode||a instanceof e.AST.BooleanNode)&&s.push(n.id.string),u=k(a.parts);for(var f in u)u[f]&&(o=u[f]||o,s.push(n.id.string),r.push(i+u[f]))})}n&&n.mustache&&L([n.mustache],r,i+o,s),n&&n.program&&n.program.statements&&(f=L([n.mustache],[],"",s)[0]||"",n.program.inverse&&n.program.inverse.statements&&L(n.program.inverse.statements,r,i+o+(f?i+o?"."+f:f:""),s),L(n.program.statements,r,i+o+(f?i+o?"."+f:f:""),s))}),r}function A(e){var n=[],r=[];e&&e.statements&&(n=L(e.statements,[],undefined,r));var i=["helperMissing","blockHelperMissing","each","if","unless","with"];return{vars:t(n).chain().unique().map(function(e){return e===""?".":e.length&&e[e.length-1]==="."?e.substr(0,e.length-1)+"[]":e}).value(),helpers:t(r).chain().unique().map(function(e){return t(i).contains(e)?undefined:e}).compact().value()}}function O(f){o(M,function(o){var l=e.parse(o),d=N(l),g=C(l),x=A(l),T=x.vars,k=x.helpers||[],L=d.join("', 'hbs!").replace(/_/g,"/"),O=w.hbs&&w.hbs.disableHelpers?"":function(){var e,t=[],n=w.hbs&&w.hbs.helperPathCallback?w.hbs.helperPathCallback:function(e){return(w.hbs&&w.hbs.helperDirectory?w.hbs.helperDirectory:p)+e};for(e=0;e<k.length;e++)t[e]="'"+n(k[e],M)+"'";return t}().join(","),D="",P="",H="",B,j,F;L&&(L=",'hbs!"+L+"'"),O&&(O=","+O);if(g!=="{}")try{B=JSON.parse(g),B&&B.styles&&(y=t.union(y,B.styles),require.isBrowser&&!w.isBuild?(j=document.head||document.getElementsByTagName("head")[0],t(B.styles).forEach(function(e){b[e]||(F=document.createElement("link"),F.href=w.baseUrl+c+e+".css",F.media="all",F.rel="stylesheet",F.type="text/css",j.appendChild(F),b[e]=F)})):w.isBuild&&function(){var e=require.nodeRequire("fs"),n=t(B.styles).map(function(e){return b[e]?"":(b[e]=!0,"@import url("+e+".css);\n")}).join("\n");e.open(__dirname+h+v,a,"0666",function(t,r){e.writeSync(r,n,null,encoding="utf8"),e.close(r)}),a="a"}())}catch(I){console.log("error injecting styles")}!w.isBuild&&!w.serverRender&&(D="<!-- START - "+i+" -->",P="<!-- END - "+i+" -->",H="t.meta = "+g+";\n"+"t.helpers = "+JSON.stringify(k)+";\n"+"t.deps = "+JSON.stringify(d)+";\n"+"t.vars = "+JSON.stringify(T)+";\n");var q=S?!1:t.extend(f,w.localeMapping),R=w.hbs||{},U=t.extend(R.compileOptions||{},{originalKeyFallback:R.originalKeyFallback}),z=n(o,q,U);o="/* START_TEMPLATE */\ndefine(['hbs','handlebars'"+L+O+"], function( hbs, Handlebars ){ \n"+"var t = Handlebars.template("+z+");\n"+"Handlebars.registerPartial('"+i.replace(/\//g,"_")+"', t);\n"+H+"return t;\n"+"});\n"+"/* END_TEMPLATE */\n",w.isBuild&&(u[E]=o),w.isBuild||(o+="\r\n//@ sourceURL="+M);for(var W in d)d.hasOwnProperty(W)&&(d[W]="hbs!"+d[W].replace(/_/g,"/"));w.isBuild?(m.fromText(i,o),s([i],function(e){m(e)})):require(d,function(){m.fromText(o),s([i],function(e){m(e)})}),w.removeCombined&&r.unlinkSync(M)})}var E=i+l,S=w.hbs&&w.hbs.disableI18n,x=[],M,D=w.hbs&&w.hbs.templateExtension===!1;D?M=s.toUrl(i):M=s.toUrl(i+"."+(w.hbs&&w.hbs.templateExtension?w.hbs.templateExtension:f));if(S)O(!1);else{var P=(w.hbs&&w.hbs.i18nDirectory?w.hbs.i18nDirectory:d)+(w.locale||"en_us")+".json";try{g(s.toUrl(P),function(e){O(JSON.parse(e))})}catch(H){if(!!w.hbs)throw H;console.warn("hbs: Error reading "+P+", disabling i18n. Ignore this if you're using jam, otherwise check your i18n configuration.\n"),w.hbs={disableI18n:!0},O(!1)}}}}});